class SlideAnimator{constructor(e){this.slideContent=e}animate(e,t){return new Promise(i=>{this.slideContent.classList.remove("sliding-left","sliding-right","slide-enter-left","slide-enter-right"),this.slideContent.offsetWidth,this.slideContent.classList.add(`sliding-${e}`),setTimeout(()=>{t(),this.slideContent.classList.remove(`sliding-${e}`),this.slideContent.classList.add(`slide-enter-${"left"===e?"right":"left"}`),setTimeout(()=>{this.slideContent.classList.remove(`slide-enter-${"left"===e?"right":"left"}`),i()},CONFIG.ANIMATION_DURATION)},CONFIG.ANIMATION_DURATION)})}}class EventHandler{constructor(e){this.app=e,this.slideAnimator=null,this.hammer=null,this.boundHandleKeydown=this.handleKeydown.bind(this),this.initializeEventListeners()}initializeEventListeners(){try{let e=document.createElement("style");e.textContent=`
                #upload-container,
                #presentation-wrapper {
                    touch-action: auto !important;
                    -webkit-overflow-scrolling: touch;
                    overflow-y: auto;
                    height: 100%;
                    overscroll-behavior-y: contain;
                }
                
                #slide-container {
                    touch-action: pan-y !important;
                }
            `,document.head.appendChild(e),this.setupDemoButton(),this.setupGestureHandling(),this.setupPauseButton(),this.setupFileUploads(),this.setupKeyboardNavigation()}catch(t){console.error("Failed to initialize event listeners:",t)}}cleanup(){this.hammer&&this.hammer.destroy(),this.uploadHammer&&this.uploadHammer.destroy(),document.removeEventListener("keydown",this.boundHandleKeydown)}setupDemoButton(){let e=document.getElementById("startButton");if(!e)throw Error("Start button element not found");e.addEventListener("click",()=>{if(!window.SAMPLE_DATA){console.error("Sample data not found");return}this.app.processCsvData(window.SAMPLE_DATA)})}setupGestureHandling(){let e=document.getElementById("slide-container"),t=document.getElementById("slide-content");if(!e||!t)throw Error("Slide container or content elements not found");this.slideAnimator=new SlideAnimator(t),this.setupClickHandling(e),this.setupSwipeHandling(e)}setupClickHandling(e){e.addEventListener("click",t=>{if(t.target.closest("#pauseButton")){t.preventDefault(),t.stopPropagation();return}let i=e.getBoundingClientRect(),n=t.clientX-i.left,s=i.width;n<s*CONFIG.CLICK_ZONES.LEFT?this.app.previousSlide():n>s*CONFIG.CLICK_ZONES.RIGHT&&this.app.nextSlide()})}setupSwipeHandling(e){try{let t=0,i=0,n=!1,s=0;e.addEventListener("touchstart",e=>{t=e.touches[0].clientX,i=e.touches[0].clientY},{passive:!0}),e.addEventListener("touchend",e=>{let a=e.changedTouches[0].clientX,l=e.changedTouches[0].clientY,o=a-t,r=l-i;if(Math.abs(o)>Math.abs(r)&&Math.abs(o)>50){let d=Date.now();if(n||d-s<500)return;n=!0,s=d;let p=o>0?"right":"left";this.slideAnimator.animate(p,()=>{"left"===p?this.app.nextSlide():this.app.previousSlide(),setTimeout(()=>{n=!1},CONFIG.ANIMATION_DURATION)})}},{passive:!0})}catch(a){console.error("Error setting up touch handlers:",a)}}setupPauseButton(){let e=document.getElementById("pauseButton");if(!e)throw Error("Pause button element not found");e.addEventListener("click",e=>{e.stopPropagation(),this.app.togglePause(),this.updatePauseIcon()})}updatePauseIcon(){this.app.pauseIcon&&(this.app.pauseIcon.setAttribute("data-lucide",this.app.isPaused?"play":"pause"),lucide.createIcons())}setupFileUploads(){["csvFile","presentationCsvFile"].forEach(e=>{let t=document.getElementById(e);if(!t){console.warn(`File input ${e} not found`);return}t.addEventListener("change",this.handleFileUpload.bind(this))})}async handleFileUpload(e){let t=e.target.files[0];if(t){if(!CONFIG.ACCEPTED_FILE_TYPES.includes(t.type)){console.error("Invalid file type. Please upload a CSV file.");return}try{let i=await this.readFileAsync(t);await this.processFileData(i)}catch(n){console.error("Error processing file:",n)}}}readFileAsync(e){return new Promise((t,i)=>{let n=new FileReader;n.onload=e=>t(e.target.result),n.onerror=()=>i(Error("Error reading file")),n.readAsText(e)})}async processFileData(e){await new Promise(e=>setTimeout(e,0)),this.app.processCsvData(e)}setupKeyboardNavigation(){document.addEventListener("keydown",this.boundHandleKeydown)}handleKeydown(e){switch(e.code){case"Space":this.app.togglePause(),this.updatePauseIcon();break;case"ArrowLeft":this.app.previousSlide();break;case"ArrowRight":this.app.nextSlide()}}}window.EventHandler=EventHandler;
